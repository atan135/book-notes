通过物理模型、体系结构模型、基础模型三个方面描述分布式系统的设计方面。通过交互模型、故障模型、安全模型讨论分布式系统遇到的难点。

<hr>

# 概念描述
* 物理模型：考虑的是组成系统的计算机和设备的类型以及他们的互联
* 体系结构模型：从系统的计算元素执行的计算和通信任务方面描述系统
* 基础模型：菜用抽象的观点描述分布式系统的某个方面的解决方案
  1. 交互模型： 考虑系统元素之间通信的结构和顺序
  2. 故障模型： 考虑一个系统可能不能正确操作的方式
  3. 安全模型： 考虑如何保护系统使其不受操作的干扰，不被窃取信息

# 分布式系统会遇到的困难
1. 使用模式的多样性，有些是高负载，有些是低延迟，有些是连接不稳定
2. 系统环境的多样性，网络、硬件、操作系统、软件的异构
3. 内部问题，包括非同步的时钟，冲突数据的更新，多种涉及单个组件的软硬件故障模式
4. 外部威胁，包括数据完整性、保密性以级服务拒绝攻击

# 体系结构模型
1. 分布式系统中通信的实体是---进程、结点、线程、对象、组件、web服务
2. 通信泛型---进程间通信、远程调用、间接通信
  间接通信技术有组通信、发布-订阅系统、消息队列、元祖空间、分布式共享内存

# 中间件
作用是为分布式系统的开发提供一个高层的编程抽象，并且通过分层，对底层基础设施中的异构性提供抽象，从而提升操作性和可移植性。

> 一些与通信相关的功能，可以只依靠通信系统终点（end point）的应用的知识的帮助，即可完整、可靠的实现。因此，将这些功能作为通信系统的特征不总是很明智的，（虽然由通信系统提供一个不完全版本的功能有时对性能提高是有用的）

> 这是 _Saltzer et al 1984_ 的观点，可以看出他们的观点与通过引入适当的中间件层将所有通信活动从应用编程中抽象出来的观点是相反的。争论的关键是分布式程序正确的行为在很多层面上依赖监察、错误校正机制和安全手段，其中有些要求访问应用的地址空间的数据。任何企图在通信系统中单独完成的监察将只能保证部分正确性。因此，可能在应用程序中重复同样的任务，降低了编程效率，更重要的是增加了不必要的复杂性并要执行冗余的计算。   ----<font color=red>没看太懂</font>

**同步分布式系统**
* 进程执行每一步的时间都有一个上限和下限
* 通过通道传递的每个消息在一个已知的时间范围内接收
* 每个进程有一个本地时钟，它与实际时间的偏移率在一个已知的范围

**异步分布式系统**
* 进程的执行时间没有限制
* 消息传递的延时没有限制
* 时钟漂移率是可以任意的

**安全通道**
* 每个进程知道其他正在执行的进程的主体身份，能够检查他们的访问权限
* 确保其上传送到数据的私密性和完整性
* 每个消息包括一个物理的或者逻辑的时间戳以防消息被重放或重排序


Q & A
=================================
1. 提供三个具体的、不同的例子，说明当代分布式系统中异构性的增加。

> * 移动计算的出现，导致对物理网络异构性的支持增加。在这种模型中，节点可以从一个网络移动到另一个网络，导致了对诸如服务发现这样的新增功能的需要和对自发互操作的支持。
> * 无处不在的计算导致了体系结构从分立节点型转向计算机被嵌入日常物品和环境中，如智能家居系统。
> * 云计算特别是集群体系结构的出现导致了从自治节点完成给定任务转向了一组节点一起提供一个给定的任务。如Google提供的搜索服务。

2. 在通信实体的直接耦合中，你能预见什么问题？你期望时空分离的解耦和具有哪些优势？

> 直接耦合的系统，需要通信双方进程同时存在，有强绑定的双向关系，会导致系统难以拆分。空间解耦和不需要发送者知道他们发送给谁，时间解耦和不需要通信双方同时存在，这样可以便于开发过程中拆解业务，也更适合服务的分布式部署。

3. 描述一个或多个主要的互联网应用的客户-服务器体系结构。给出图示。

> 1. 最简单的web服务器，C/S结构，简单的Client端调用请求，Server端返回结果
> 2. 搜索引擎，其web服务器作为Server提供给用户服务，同时作为Client抓取其他web服务器的信息汇总。
> 3. 大型网站的多层体系结构，分为Client-ServerWeb-ServerBackground-DB

4. 对题1描述的应用，在实现相关服务适合采用怎样的放置策略。

> 1. 对移动计算，适合菜用缓存，移动代理的放置策略
> 2. 对智能家居系统，使用云端计算处理
> 3. 对大规模搜索服务，使用将服务映射到多个服务器的服务放置策略。

5. 搜索引擎是一个web服务器，响应客户请求，在存储的索引中查找，并同时运行多个web抓取任务来创建和更新索引，这些并发的当前活动之间进行同步的需求是什么？

> 理论上，这些操作之间是异步的，没有需要强同步的需求。

6. 对等系统中使用的主机通常是个人计算机，对共享数据的可用性和安全性而言，意味着什么？通过使用复制能多大程度上克服这些弱点？

> 需要有数据的多备份，且使用签名校验数据的完整性。

7. 列出易受不可靠程序攻击的本地资源的类型。

> 本地文件可能被非法读取、修改。

8. 通过实例说明使用移动代码的好处。

> 本地运行的代码，可以提供良好的交互响应，不会受到网络通信的延迟或者带宽变化的影响。

9. 考虑一个假想的汽车出租公司，画出一个三层解决方案，提供基本的分布式汽车出租系统，用这个来说明三层解决方案的好处和缺点，考虑注入性能、可伸缩性、故障处理、软件长期维护等方面。

> 服务端有页面提供层，逻辑处理层，数据处理层三层，页面提供层提供所有显示相关的交互逻辑，使用逻辑处理层提供的数据，逻辑处理层处理所有相关的底层逻辑，提供接口给上层页面提供层调用，数据的存储读取更新在数据处理层。好处是业务解耦和，易于扩展，且易于定点服务异常，查找故障处理，缺点是多层调用导致服务性能降低，服务延迟增加，长期维护需要对整体架构有了解，更为困难。

10. 提供一个具体的例子，说明在分布式应用提供中间件支持方面，Saltzer的端到端争论所提及的困境。

> 感觉是在可靠性分布式系统中，授权中间件的使用之类，会导致数据被多次校验处理。

11. 设计一个简单的服务器，不用访问其他服务器就可以完成客户请求，解释为什么不可能对服务器响应客户请求的时间设置限制。需要怎样做才能使服务器可以在一定时间范围内执行操作，是一个实用的选择么？

> 不明白，这里理论上应该是可以设置时间限制的。

> 额，服务端确实是难以设置时间限制，这个限制一般是只能调起方自己设置的。因为服务进程不能确定自己每一步请求所需的时间数，如果需要服务器在一定范围内执行操作，应该是只能自己再作为服务发起方调用另一个请求方，自己这个设置超时时间。也不是一个好的使用选择，因为无论选择轮询等待还是使用事件触发等待方式，整体请求的执行过程在底层是仍然无法避免的，但是可以避免用户端客户的长时间等待，需要具体业务具体分析。

12. 针对影响通信通道上的两个进程之间传递消息所花的时间的各个因素，说明需要对哪些影响总时间的度量设置限制，为什么当前通用的分布式系统不提供这些度量？

> 因为时间难以同步，一方面初始设置时间的问题，一方面是时钟漂移率的存在，另一方面是难以使用一种方法达到完全正确的同步时间校正。

13. 网络时间协议服务能用于同步计算机时钟，解释为什么即使使用这样的服务，也不能对两个时钟之间的不同给出确定的范围。

> 原因如上

> **网络时间协议** ：
> > 英文名称：Network Time Protocol（NTP）是用来使计算机时间同步化的一种协议，它可以使计算机对其服务器或时钟源（如石英钟，GPS等等)做同步化，它可以提供高精准度的时间校正（LAN上与标准间差小于1毫秒，WAN上几十毫秒），且可介由加密确认的方式来防止恶毒的协议攻击。NTP的目的是在无序的Internet环境中提供精确和健壮的时间服务。

> 所以这个也只能在一定程度上修正服务，因为在校正中，通信时间和处理时间是不可控的，最多只能使用均值作为修正处理。

14. 考虑异步分布式系统中使用的两个通信服务，在服务A中，消息可能丢失，复制，延迟，校验和仅用于消息头，服务B中，消息可能丢失、延迟或者传递太快以至于对方无法处理它，但是到达目的地的消息内容一定正确。描述故障类型。

> 服务A是遗漏故障中的通信遗漏故障，B是进程遗漏故障。服务B可以通过校验、重传成为可靠的通信服务。

15. 有一对进程X和Y，使用题14的通信服务B相互通信，X是客户端，Y是服务端，一个调用始于X终于Y，最后Y执行后返回给X，可能出现的故障类型。

> 可能出现进程崩溃、进程故障停止、发送遗漏，接受遗漏，通信遗漏等故障。

16. 假设一个基本的磁盘读操作有时读取的值和写入的值不同。叙述基本的磁盘读操作会出现的故障类型。如何屏蔽故障以产生一种良性故障，提出建议。

> 这是一个随机故障，可以通过冗余备份、生成校验和方式检测出故障并恢复。

17. 定义可靠通信的完整性，列出所有来自用户和系统组件的对完整性的可能的威胁，面对每种威胁，可以使用什么手段确保完整性。

> 可能出现发送遗漏、通信信道过程被修改或者传递过程出错、接收端接收遗漏等问题（只考虑数据完整性）。使用的方法就是加密+签名校验。

18. 描述可能出现在互联网上的几类主要的安全威胁类型。

> * 拒绝服务：通过超量的无意义的调用服务或者网络上进行消息传递，干扰授权用户的活动。
> * 移动代码：进程接受执行来自其他地方的代码。xxs攻击类型。
> * 对进程的威胁，包括数据读取内存越界操作，sql注入之类的。